language: smalltalk
sudo: false

os:
  - linux

smalltalk:
  - Pharo-6.1

# Unit tests run the normal pillar tests
# Integration tests test that pillar itself can interact with generated files, pdf generation, etc.
# System tests test that we can install and use pillar as a black box
env:
  matrix:
  - JOB=test TYPE=System ARCHETYPE=book OUTPUT=pdf

install:
  # Pillar installation
  - git clone https://github.com/pillar-markup/pillar.git -b dev-7 # Clone pillar
  - cd pillar && ./scripts/build.sh && cd ..                              # Run pillar build script. Pillar will be built in `pwd`/build!
  - . pillar/scripts/ci/ensure_latex.sh                                   # Install latex
  - ./pillar/scripts/ci/ensure_book_dependencies.sh                       # Install latex dependencies required by pillar
  
script:
  - ./pillar/build/pillar build pdf

deploy:
- provider: bintray
  file: .bintray.json
  on:
    repo: SquareBracketAssociates/Booklet-AMiniSchemeInPharo
  skip_cleanup: true
  user: ducasse
  key:
    secure: RfCEw0iYlnS4ebsbx3qurdrtCP92hSV3JSAA+PwvQoSsBzUtxsdYrueDIFwEhOEcKOw7XKrFUNS5WvT6EZcsquB85olFQvMD0qHqMsDceNEtY+5Rhw8Qp1gQc1jBhKSZhTC9qLL3wmSmSSCHjaW7wyHNVw5fYZIUULR8kBRYh6Oo2ebcuHE7UBbow+w4laXIkYqEnPVvm6uPFshgoSF0vTpmqsInS+YkNX0uYGgQUEZw/YtaB+rNyuO2vm7PCKNrYBbfT+2VZvXuQblzE7QVuCKtXjwi57KEwot/KLZ9DQj9KlNafYSLfFGPvEVnecTLnwzC4VAOUh2nSM12fqskzH7zCqh65W9vSMcm1XoFRvhDn2TLLzVgjtB3PEfQa8oRW9tPTspTgB/yLNvwsszrSD51VV7NJxqZZQ0b6mkDsZDmkSLysXsAJ1qTgGzzCq/oOVM5vS30CJ2Zr/WdWY1VN07nl0Jdgx3Z3o1NsdpDXFKMqgU5WcTADnapm/mB3Nrl7yA4GfhfVk47KClM1arKDezN8I8r3qdjJjFg48TRw5AM1skszAchPjfOTLIzktXXLFNOSHWOU5MPn2X50zqLYvTZqX5au8PSLAMmwkUqd6ZQzj6Ymlgaz+H4RnjR7OL/VzmjOxQz5rUzA0s6mOP1HKe5gK52JG+Xvujn/VvjLrE=
